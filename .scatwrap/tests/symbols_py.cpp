<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tests/symbols_py.cpp</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#include&#32;&quot;doctest/doctest.h&quot;<br>
#include&#32;&quot;symbols.h&quot;<br>
<br>
#include&#32;&lt;string&gt;<br>
<br>
TEST_CASE(&quot;PythonSymbolFinder:&#32;simple&#32;class&#32;and&#32;methods&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;std::string&#32;src&#32;=&#32;&quot;class&#32;Foo:\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;0<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;def&#32;bar(self):\n&quot;&#32;&#32;&#32;&#32;//&#32;1<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pass\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;2<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;3<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;def&#32;baz(self,&#32;x):\n&quot;&#32;//&#32;4<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;x&#32;+&#32;1\n&quot;;&#32;//&#32;5<br>
<br>
&#32;&#32;&#32;&#32;PythonSymbolFinder&#32;finder(src);<br>
&#32;&#32;&#32;&#32;Region&#32;r_class;<br>
<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_class(&quot;Foo&quot;,&#32;r_class));<br>
&#32;&#32;&#32;&#32;CHECK(r_class.start_line&#32;==&#32;0);<br>
&#32;&#32;&#32;&#32;CHECK(r_class.end_line&#32;==&#32;5);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_bar;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Foo&quot;,&#32;&quot;bar&quot;,&#32;r_bar));<br>
&#32;&#32;&#32;&#32;CHECK(r_bar.start_line&#32;==&#32;1);<br>
&#32;&#32;&#32;&#32;CHECK(r_bar.end_line&#32;==&#32;2);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_baz;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Foo&quot;,&#32;&quot;baz&quot;,&#32;r_baz));<br>
&#32;&#32;&#32;&#32;CHECK(r_baz.start_line&#32;==&#32;4);<br>
&#32;&#32;&#32;&#32;CHECK(r_baz.end_line&#32;==&#32;5);<br>
}<br>
<br>
TEST_CASE(&quot;PythonSymbolFinder:&#32;ignores&#32;top-level&#32;functions&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;std::string&#32;src&#32;=&#32;&quot;def&#32;foo():\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;0<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;pass\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;1<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;2<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;class&#32;Foo:\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;3<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;def&#32;foo(self):\n&quot;&#32;//&#32;4<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pass\n&quot;;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;5<br>
<br>
&#32;&#32;&#32;&#32;PythonSymbolFinder&#32;finder(src);<br>
&#32;&#32;&#32;&#32;Region&#32;r_class;<br>
<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_class(&quot;Foo&quot;,&#32;r_class));<br>
&#32;&#32;&#32;&#32;CHECK(r_class.start_line&#32;==&#32;3);<br>
&#32;&#32;&#32;&#32;CHECK(r_class.end_line&#32;==&#32;5);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_method;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Foo&quot;,&#32;&quot;foo&quot;,&#32;r_method));<br>
&#32;&#32;&#32;&#32;CHECK(r_method.start_line&#32;==&#32;4);<br>
&#32;&#32;&#32;&#32;CHECK(r_method.end_line&#32;==&#32;5);<br>
}<br>
<br>
TEST_CASE(&quot;PythonSymbolFinder:&#32;decorated&#32;methods&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;std::string&#32;src&#32;=&#32;&quot;class&#32;Foo:\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;0<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;@decorator\n&quot;&#32;&#32;&#32;&#32;&#32;//&#32;1<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;def&#32;bar(self):\n&quot;&#32;//&#32;2<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pass\n&quot;;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;3<br>
<br>
&#32;&#32;&#32;&#32;PythonSymbolFinder&#32;finder(src);<br>
&#32;&#32;&#32;&#32;Region&#32;r_method;<br>
<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Foo&quot;,&#32;&quot;bar&quot;,&#32;r_method));<br>
&#32;&#32;&#32;&#32;CHECK(r_method.start_line&#32;==&#32;1);&#32;//&#32;вместе&#32;с&#32;декоратором<br>
&#32;&#32;&#32;&#32;CHECK(r_method.end_line&#32;==&#32;3);<br>
}<br>
<br>
TEST_CASE(&quot;PythonSymbolFinder:&#32;nested&#32;class&#32;and&#32;methods&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;std::string&#32;src&#32;=&#32;&quot;class&#32;Outer:\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;0<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;def&#32;a(self):\n&quot;&#32;&#32;&#32;&#32;&#32;//&#32;1<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pass\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;2<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;class&#32;Inner:\n&quot;&#32;&#32;&#32;&#32;&#32;//&#32;3<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;def&#32;b(self):\n&quot;&#32;//&#32;4<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pass\n&quot;;&#32;&#32;&#32;&#32;//&#32;5<br>
<br>
&#32;&#32;&#32;&#32;PythonSymbolFinder&#32;finder(src);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_outer;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_class(&quot;Outer&quot;,&#32;r_outer));<br>
&#32;&#32;&#32;&#32;CHECK(r_outer.start_line&#32;==&#32;0);<br>
&#32;&#32;&#32;&#32;CHECK(r_outer.end_line&#32;==&#32;5);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_a;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Outer&quot;,&#32;&quot;a&quot;,&#32;r_a));<br>
&#32;&#32;&#32;&#32;CHECK(r_a.start_line&#32;==&#32;1);<br>
&#32;&#32;&#32;&#32;CHECK(r_a.end_line&#32;==&#32;2);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_inner_class;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_class(&quot;Inner&quot;,&#32;r_inner_class));<br>
&#32;&#32;&#32;&#32;CHECK(r_inner_class.start_line&#32;==&#32;3);<br>
&#32;&#32;&#32;&#32;CHECK(r_inner_class.end_line&#32;==&#32;5);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_b;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Inner&quot;,&#32;&quot;b&quot;,&#32;r_b));<br>
&#32;&#32;&#32;&#32;CHECK(r_b.start_line&#32;==&#32;4);<br>
&#32;&#32;&#32;&#32;CHECK(r_b.end_line&#32;==&#32;5);<br>
}<br>
<br>
TEST_CASE(&quot;PythonSymbolFinder:&#32;async&#32;methods&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;std::string&#32;src&#32;=&#32;&quot;class&#32;Foo:\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;0<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;async&#32;def&#32;bar(self):\n&quot;&#32;&#32;&#32;//&#32;1<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;await&#32;something()\n&quot;;&#32;//&#32;2<br>
<br>
&#32;&#32;&#32;&#32;PythonSymbolFinder&#32;finder(src);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_class;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_class(&quot;Foo&quot;,&#32;r_class));<br>
&#32;&#32;&#32;&#32;CHECK(r_class.start_line&#32;==&#32;0);<br>
&#32;&#32;&#32;&#32;CHECK(r_class.end_line&#32;==&#32;2);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_bar;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Foo&quot;,&#32;&quot;bar&quot;,&#32;r_bar));<br>
&#32;&#32;&#32;&#32;CHECK(r_bar.start_line&#32;==&#32;1);<br>
&#32;&#32;&#32;&#32;CHECK(r_bar.end_line&#32;==&#32;2);<br>
}<br>
<br>
TEST_CASE(&quot;PythonSymbolFinder:&#32;whitespace,&#32;comments&#32;and&#32;docstrings&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;std::string&#32;src&#32;=&#32;&quot;#!/usr/bin/env&#32;python3\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;0<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;1<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;class&#32;&#32;&#32;Weird&#32;&#32;(&#32;&#32;Base&#32;&#32;):\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;2<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;\\\&quot;\\\&quot;\\\&quot;docstring\\\&quot;\\\&quot;\\\&quot;\n&quot;&#32;//&#32;3<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;#&#32;comment&#32;inside&#32;class\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;4<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;def&#32;&#32;&#32;run&#32;(&#32;self,&#32;&#32;x&#32;):\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;5<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;#&#32;inner&#32;comment\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;6<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;x&#32;+&#32;1\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;7<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;8<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;def&#32;run(x):\n&quot;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;9<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&#32;&#32;&#32;&#32;return&#32;x\n&quot;;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;10<br>
<br>
&#32;&#32;&#32;&#32;PythonSymbolFinder&#32;finder(src);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_class;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_class(&quot;Weird&quot;,&#32;r_class));<br>
&#32;&#32;&#32;&#32;CHECK(r_class.start_line&#32;==&#32;2);<br>
&#32;&#32;&#32;&#32;CHECK(r_class.end_line&#32;==&#32;7);<br>
<br>
&#32;&#32;&#32;&#32;Region&#32;r_run;<br>
&#32;&#32;&#32;&#32;CHECK(finder.find_method(&quot;Weird&quot;,&#32;&quot;run&quot;,&#32;r_run));<br>
&#32;&#32;&#32;&#32;CHECK(r_run.start_line&#32;==&#32;5);<br>
&#32;&#32;&#32;&#32;CHECK(r_run.end_line&#32;==&#32;7);<br>
}<br>
<!-- END SCAT CODE -->
</body>
</html>
