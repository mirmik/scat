<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tests/collector_glob_exclude.cpp</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#include&#32;&quot;collector.h&quot;<br>
#include&#32;&quot;doctest/doctest.h&quot;<br>
#include&#32;&quot;glob.h&quot;<br>
#include&#32;&quot;options.h&quot;<br>
#include&#32;&quot;rules.h&quot;<br>
<br>
#include&#32;&lt;algorithm&gt;<br>
#include&#32;&lt;filesystem&gt;<br>
#include&#32;&lt;fstream&gt;<br>
#include&#32;&lt;vector&gt;<br>
<br>
namespace&#32;fs&#32;=&#32;std::filesystem;<br>
<br>
//&#32;-----------------------------------------------------------------------------<br>
//&#32;Helpers<br>
//&#32;-----------------------------------------------------------------------------<br>
<br>
static&#32;void&#32;write_file(const&#32;fs::path&#32;&amp;p,&#32;const&#32;std::string&#32;&amp;text)<br>
{<br>
&#32;&#32;&#32;&#32;fs::create_directories(p.parent_path());<br>
&#32;&#32;&#32;&#32;std::ofstream&#32;out(p);<br>
&#32;&#32;&#32;&#32;out&#32;&lt;&lt;&#32;text;<br>
}<br>
<br>
static&#32;std::vector&lt;std::string&gt;&#32;to_rel(const&#32;std::vector&lt;fs::path&gt;&#32;&amp;v,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;fs::path&#32;&amp;root)<br>
{<br>
&#32;&#32;&#32;&#32;std::vector&lt;std::string&gt;&#32;out;<br>
&#32;&#32;&#32;&#32;for&#32;(auto&#32;&amp;p&#32;:&#32;v)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;out.push_back(fs::relative(p,&#32;root).generic_string());<br>
&#32;&#32;&#32;&#32;std::sort(out.begin(),&#32;out.end());<br>
&#32;&#32;&#32;&#32;return&#32;out;<br>
}<br>
<br>
static&#32;void&#32;check_paths(const&#32;std::vector&lt;std::string&gt;&#32;&amp;actual,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::initializer_list&lt;const&#32;char&#32;*&gt;&#32;expected)<br>
{<br>
&#32;&#32;&#32;&#32;std::vector&lt;std::string&gt;&#32;exp_vec;<br>
&#32;&#32;&#32;&#32;exp_vec.reserve(expected.size());<br>
&#32;&#32;&#32;&#32;for&#32;(auto&#32;*e&#32;:&#32;expected)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;exp_vec.emplace_back(e);<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;std::string&gt;&#32;act&#32;=&#32;actual;<br>
<br>
&#32;&#32;&#32;&#32;std::sort(exp_vec.begin(),&#32;exp_vec.end());<br>
&#32;&#32;&#32;&#32;std::sort(act.begin(),&#32;act.end());<br>
<br>
&#32;&#32;&#32;&#32;CHECK(act.size()&#32;==&#32;exp_vec.size());<br>
<br>
&#32;&#32;&#32;&#32;if&#32;(act.size()&#32;!=&#32;exp_vec.size())<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return;&#32;//&#32;предотвратить&#32;каскад&#32;ошибок<br>
<br>
&#32;&#32;&#32;&#32;for&#32;(size_t&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;act.size();&#32;++i)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;CHECK(act[i]&#32;==&#32;exp_vec[i]);<br>
}<br>
<br>
//&#32;============================================================================<br>
//&#32;glob&#32;tests&#32;—&#32;как&#32;раньше,&#32;без&#32;смены&#32;current_path<br>
//&#32;============================================================================<br>
<br>
TEST_CASE(&quot;glob:&#32;basic&#32;*&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;glob_test_a2&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;a.txt&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;b.cpp&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;c.txt&quot;,&#32;&quot;C&quot;);<br>
<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;expand_glob((tmp&#32;/&#32;&quot;*.txt&quot;).generic_string());<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,&#32;{&quot;a.txt&quot;,&#32;&quot;c.txt&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;glob:&#32;recursive&#32;**&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;glob_test_b2&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;1.txt&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;x/2.txt&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;x/y/3.txt&quot;,&#32;&quot;C&quot;);<br>
<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;expand_glob((tmp&#32;/&#32;&quot;**&quot;).generic_string());<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,&#32;{&quot;1.txt&quot;,&#32;&quot;x/2.txt&quot;,&#32;&quot;x/y/3.txt&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;glob:&#32;**/*.cpp&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;glob_test_c2&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;a.cpp&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;b.h&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;x/c.cpp&quot;,&#32;&quot;C&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;x/y/z.cpp&quot;,&#32;&quot;Z&quot;);<br>
<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;expand_glob((tmp&#32;/&#32;&quot;**/*.cpp&quot;).generic_string());<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,&#32;{&quot;a.cpp&quot;,&#32;&quot;x/c.cpp&quot;,&#32;&quot;x/y/z.cpp&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;glob:&#32;foo/*/bar/**/*.txt&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;glob_test_d2&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;foo/K/bar/a.txt&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;foo/K/bar/x/b.txt&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;foo/X/bar/c.bin&quot;,&#32;&quot;C&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;foo/Z/bar/y/z.txt&quot;,&#32;&quot;Z&quot;);<br>
<br>
&#32;&#32;&#32;&#32;auto&#32;pat&#32;=&#32;(tmp&#32;/&#32;&quot;foo/*/bar/**/*.txt&quot;).generic_string();<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;expand_glob(pat);<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&quot;foo/K/bar/a.txt&quot;,&#32;&quot;foo/K/bar/x/b.txt&quot;,&#32;&quot;foo/Z/bar/y/z.txt&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;glob:&#32;no&#32;matches&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;glob_test_e2&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;file.cpp&quot;,&#32;&quot;A&quot;);<br>
<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;expand_glob((tmp&#32;/&#32;&quot;**/*.txt&quot;).generic_string());<br>
&#32;&#32;&#32;&#32;CHECK(out.empty());<br>
}<br>
<br>
//&#32;============================================================================<br>
//&#32;collector&#32;tests&#32;—&#32;тоже&#32;на&#32;абсолютных&#32;путях<br>
//&#32;============================================================================<br>
<br>
TEST_CASE(&quot;collector:&#32;include&#32;then&#32;exclude&#32;subdir&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;collector_test_1&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/a.cpp&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/b.cpp&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/tests/c.cpp&quot;,&#32;&quot;C&quot;);<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;Rule&gt;&#32;rules&#32;=&#32;{{(tmp&#32;/&#32;&quot;src/**/*.cpp&quot;).generic_string(),&#32;false},<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;src/tests/**&quot;).generic_string(),&#32;true}};<br>
<br>
&#32;&#32;&#32;&#32;Options&#32;opt;<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;collect_from_rules(rules,&#32;opt);<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,&#32;{&quot;src/a.cpp&quot;,&#32;&quot;src/b.cpp&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;collector:&#32;exclude&#32;*.cpp&#32;top&#32;level&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;collector_test_2&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;a.cpp&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;b.h&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;sub/c.cpp&quot;,&#32;&quot;C&quot;);<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;Rule&gt;&#32;rules&#32;=&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;**&quot;).generic_string(),&#32;false},<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;*.cpp&quot;).generic_string(),&#32;true},<br>
&#32;&#32;&#32;&#32;};<br>
<br>
&#32;&#32;&#32;&#32;Options&#32;opt;<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;collect_from_rules(rules,&#32;opt);<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,&#32;{&quot;b.h&quot;,&#32;&quot;sub/c.cpp&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;collector:&#32;exclude&#32;all&#32;cpp&#32;recursively&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;collector_test_3&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;a.cpp&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;x/b.cpp&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;x/y/c.cpp&quot;,&#32;&quot;C&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;ok.txt&quot;,&#32;&quot;D&quot;);<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;Rule&gt;&#32;rules&#32;=&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;**&quot;).generic_string(),&#32;false},<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;**/*.cpp&quot;).generic_string(),&#32;true},<br>
&#32;&#32;&#32;&#32;};<br>
<br>
&#32;&#32;&#32;&#32;Options&#32;opt;<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;collect_from_rules(rules,&#32;opt);<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,&#32;{&quot;ok.txt&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;collector:&#32;include-exclude-include&#32;chain&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;collector_test_4&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;data/keep/a.txt&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;data/keep/b.cpp&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;data/drop/c.txt&quot;,&#32;&quot;C&quot;);<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;Rule&gt;&#32;rules&#32;=&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;data/**&quot;).generic_string(),&#32;false},<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;data/drop/**&quot;).generic_string(),&#32;true},<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;data/keep/*.txt&quot;).generic_string(),&#32;false},<br>
&#32;&#32;&#32;&#32;};<br>
<br>
&#32;&#32;&#32;&#32;Options&#32;opt;<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;collect_from_rules(rules,&#32;opt);<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;check_paths(rel,&#32;{&quot;data/keep/a.txt&quot;,&#32;&quot;data/keep/b.cpp&quot;});<br>
}<br>
<br>
TEST_CASE(&quot;collector:&#32;empty&#32;after&#32;exclude&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;collector_test_5&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;a.txt&quot;,&#32;&quot;A&quot;);<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;Rule&gt;&#32;rules&#32;=&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;*.txt&quot;).generic_string(),&#32;false},<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;*.txt&quot;).generic_string(),&#32;true},<br>
&#32;&#32;&#32;&#32;};<br>
<br>
&#32;&#32;&#32;&#32;Options&#32;opt;<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;collect_from_rules(rules,&#32;opt);<br>
<br>
&#32;&#32;&#32;&#32;CHECK(out.empty());<br>
}<br>
<br>
TEST_CASE(&quot;collector:&#32;complex&#32;structure&#32;with&#32;5&#32;rules&quot;)<br>
{<br>
&#32;&#32;&#32;&#32;fs::path&#32;tmp&#32;=&#32;fs::temp_directory_path()&#32;/&#32;&quot;collector_complex_test&quot;;<br>
&#32;&#32;&#32;&#32;fs::remove_all(tmp);<br>
<br>
&#32;&#32;&#32;&#32;//&#32;----------------------------<br>
&#32;&#32;&#32;&#32;//&#32;создаём&#32;структуру&#32;на&#32;15&#32;файлов<br>
&#32;&#32;&#32;&#32;//&#32;----------------------------<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;root.txt&quot;,&#32;&quot;R&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;root.bin&quot;,&#32;&quot;RB&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;readme.md&quot;,&#32;&quot;MD&quot;);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/a.cpp&quot;,&#32;&quot;A&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/b.cpp&quot;,&#32;&quot;B&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/c.log&quot;,&#32;&quot;CLOG&quot;);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/tools/t1.txt&quot;,&#32;&quot;T1&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/tools/t2.txt&quot;,&#32;&quot;T2&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;src/tools/helper.cpp&quot;,&#32;&quot;HC&quot;);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;data/info.txt&quot;,&#32;&quot;INFO&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;data/raw/raw1.bin&quot;,&#32;&quot;BIN1&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;data/raw/raw2.bin&quot;,&#32;&quot;BIN2&quot;);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;build/tmp1.log&quot;,&#32;&quot;TMP1&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;build/tmp2.log&quot;,&#32;&quot;TMP2&quot;);<br>
<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;misc/x.cpp&quot;,&#32;&quot;X&quot;);<br>
&#32;&#32;&#32;&#32;write_file(tmp&#32;/&#32;&quot;misc/y.txt&quot;,&#32;&quot;Y&quot;);<br>
<br>
&#32;&#32;&#32;&#32;//&#32;----------------------------<br>
&#32;&#32;&#32;&#32;//&#32;ПРАВИЛА<br>
&#32;&#32;&#32;&#32;//&#32;----------------------------<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;Rule&gt;&#32;rules&#32;=&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;1)&#32;собрать&#32;всё<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;**&quot;).generic_string(),&#32;false},<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;2)&#32;исключить&#32;data/raw/**<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;data/raw/**&quot;).generic_string(),&#32;true},<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;3)&#32;исключить&#32;все&#32;*.log<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;**/*.log&quot;).generic_string(),&#32;true},<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;4)&#32;добавить&#32;текстовые&#32;файлы&#32;только&#32;в&#32;tools<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;src/tools/*.txt&quot;).generic_string(),&#32;false},<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;5)&#32;исключить&#32;бинарники&#32;только&#32;в&#32;корне&#32;(root.bin)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{(tmp&#32;/&#32;&quot;*.bin&quot;).generic_string(),&#32;true}};<br>
<br>
&#32;&#32;&#32;&#32;Options&#32;opt;<br>
&#32;&#32;&#32;&#32;auto&#32;out&#32;=&#32;collect_from_rules(rules,&#32;opt);<br>
&#32;&#32;&#32;&#32;auto&#32;rel&#32;=&#32;to_rel(out,&#32;tmp);<br>
<br>
&#32;&#32;&#32;&#32;//&#32;----------------------------<br>
&#32;&#32;&#32;&#32;//&#32;ОЖИДАЕМЫЙ&#32;РЕЗУЛЬТАТ<br>
&#32;&#32;&#32;&#32;//&#32;----------------------------<br>
&#32;&#32;&#32;&#32;//<br>
&#32;&#32;&#32;&#32;//&#32;Файлы,&#32;которые&#32;должны&#32;остаться:<br>
&#32;&#32;&#32;&#32;//<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;root.txt<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;readme.md<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;src/a.cpp<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;src/b.cpp<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;src/tools/t1.txt<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;src/tools/t2.txt<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;src/tools/helper.cpp<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;data/info.txt<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;misc/x.cpp<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;misc/y.txt<br>
&#32;&#32;&#32;&#32;//<br>
&#32;&#32;&#32;&#32;//&#32;НЕ&#32;должно&#32;быть:<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;data/raw/*&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(правило&#32;#2)<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;*.log&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(правило&#32;#3)<br>
&#32;&#32;&#32;&#32;//&#32;&#32;&#32;root.bin&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(правило&#32;#5)<br>
&#32;&#32;&#32;&#32;//<br>
&#32;&#32;&#32;&#32;check_paths(rel,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;root.txt&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;readme.md&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;src/a.cpp&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;src/b.cpp&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;src/tools/t1.txt&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;src/tools/t2.txt&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;src/tools/helper.cpp&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;data/info.txt&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;misc/x.cpp&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;misc/y.txt&quot;,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;});<br>
}<br>
<!-- END SCAT CODE -->
</body>
</html>
