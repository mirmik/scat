<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tests/main.cpp</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#define&#32;DOCTEST_CONFIG_IMPLEMENT<br>
#include&#32;&quot;doctest/doctest.h&quot;<br>
#include&#32;&lt;string&gt;<br>
#include&#32;&lt;vector&gt;<br>
#if&#32;defined(__WIN32__)&#32;||&#32;defined(_MSC_VER)<br>
#include&#32;&lt;winsock2.h&gt;<br>
WSADATA&#32;wsaData;<br>
#endif<br>
<br>
int&#32;main(int&#32;argc,&#32;char&#32;**argv)<br>
{<br>
#if&#32;defined(__WIN32__)&#32;||&#32;defined(_MSC_VER)<br>
&#32;&#32;&#32;&#32;int&#32;iResult;<br>
<br>
&#32;&#32;&#32;&#32;//&#32;Initialize&#32;Winsock<br>
&#32;&#32;&#32;&#32;iResult&#32;=&#32;WSAStartup(MAKEWORD(2,&#32;2),&#32;&amp;wsaData);<br>
&#32;&#32;&#32;&#32;if&#32;(iResult&#32;!=&#32;0)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;printf(&quot;WSAStartup&#32;failed:&#32;%d\n&quot;,&#32;iResult);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;1;<br>
&#32;&#32;&#32;&#32;}<br>
#endif<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;std::string&gt;&#32;adjusted_args;<br>
&#32;&#32;&#32;&#32;adjusted_args.reserve(argc);<br>
&#32;&#32;&#32;&#32;for&#32;(int&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;argc;&#32;++i)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::string&#32;current(argv[i]);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;((current&#32;==&#32;&quot;--test-case&quot;&#32;||&#32;current&#32;==&#32;&quot;-tc&quot;)&#32;&amp;&amp;&#32;i&#32;+&#32;1&#32;&lt;&#32;argc)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::string&#32;pattern(argv[i&#32;+&#32;1]);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pattern.find('*')&#32;==&#32;std::string::npos)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pattern&#32;=&#32;&quot;*&quot;&#32;+&#32;pattern&#32;+&#32;&quot;*&quot;;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;adjusted_args.push_back(current&#32;+&#32;&quot;=&quot;&#32;+&#32;pattern);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++i;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;adjusted_args.push_back(std::move(current));<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;std::vector&lt;char&#32;*&gt;&#32;argv_adjusted;<br>
&#32;&#32;&#32;&#32;argv_adjusted.reserve(adjusted_args.size());<br>
&#32;&#32;&#32;&#32;for&#32;(auto&#32;&amp;arg&#32;:&#32;adjusted_args)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;argv_adjusted.push_back(arg.data());<br>
&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;doctest::Context&#32;context;<br>
&#32;&#32;&#32;&#32;context.applyCommandLine(static_cast&lt;int&gt;(argv_adjusted.size()),<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;argv_adjusted.data());<br>
&#32;&#32;&#32;&#32;int&#32;res&#32;=&#32;context.run();&#32;&#32;//&#32;run<br>
&#32;&#32;&#32;&#32;if&#32;(context.shouldExit())&#32;//&#32;important&#32;-&#32;query&#32;flags&#32;(and&#32;--exit)&#32;rely&#32;on<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;the&#32;user&#32;doing&#32;this<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;res;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;propagate&#32;the&#32;result&#32;of&#32;the&#32;tests<br>
&#32;&#32;&#32;&#32;int&#32;client_stuff_return_code&#32;=&#32;0;<br>
&#32;&#32;&#32;&#32;return&#32;res&#32;+&#32;client_stuff_return_code;&#32;//&#32;the&#32;result&#32;from&#32;doctest&#32;is<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;propagated&#32;here&#32;as&#32;well<br>
}<br>
<!-- END SCAT CODE -->
</body>
</html>
