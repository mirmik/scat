<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tests/apply_symbols.cpp</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#include &#20;&quot;doctest/doctest.h&quot;<br>
#include &#20;&lt;filesystem&gt;<br>
#include &#20;&lt;fstream&gt;<br>
#include &#20;&lt;string&gt;<br>
#include &#20;&lt;vector&gt;<br>
<br>
int &#20;apply_chunk_main(int &#20;argc, &#20;char &#20;**argv);<br>
<br>
namespace &#20;fs &#20;= &#20;std::filesystem;<br>
<br>
static &#20;std::vector&lt;std::string&gt; &#20;read_lines(const &#20;fs::path &#20;&amp;p)<br>
{<br>
 &#20; &#20; &#20; &#20;std::ifstream &#20;in(p);<br>
 &#20; &#20; &#20; &#20;std::vector&lt;std::string&gt; &#20;v;<br>
 &#20; &#20; &#20; &#20;std::string &#20;s;<br>
 &#20; &#20; &#20; &#20;while &#20;(std::getline(in, &#20;s))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;v.push_back(s);<br>
 &#20; &#20; &#20; &#20;return &#20;v;<br>
}<br>
<br>
static &#20;int &#20;run_apply(const &#20;fs::path &#20;&amp;patch)<br>
{<br>
 &#20; &#20; &#20; &#20;std::string &#20;a0 &#20;= &#20;&quot;apply&quot;;<br>
 &#20; &#20; &#20; &#20;std::string &#20;a1 &#20;= &#20;patch.string();<br>
<br>
 &#20; &#20; &#20; &#20;std::vector&lt;std::string&gt; &#20;store &#20;= &#20;{a0, &#20;a1};<br>
 &#20; &#20; &#20; &#20;std::vector&lt;char &#20;*&gt; &#20;argv;<br>
 &#20; &#20; &#20; &#20;argv.reserve(store.size());<br>
 &#20; &#20; &#20; &#20;for &#20;(auto &#20;&amp;s &#20;: &#20;store)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;argv.push_back(s.data());<br>
<br>
 &#20; &#20; &#20; &#20;return &#20;apply_chunk_main((int)argv.size(), &#20;argv.data());<br>
}<br>
<br>
// &#20;============================================================================<br>
// &#20;C++: &#20;replace-cpp-class<br>
// &#20;============================================================================<br>
TEST_CASE(&quot;symbol &#20;API: &#20;replace-cpp-class &#20;replaces &#20;only &#20;target &#20;class&quot;)<br>
{<br>
 &#20; &#20; &#20; &#20;fs::path &#20;tmp &#20;= &#20;fs::temp_directory_path() &#20;/ &#20;&quot;symbol_cpp_class&quot;;<br>
 &#20; &#20; &#20; &#20;fs::remove_all(tmp);<br>
 &#20; &#20; &#20; &#20;fs::create_directories(tmp);<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;f &#20;= &#20;tmp &#20;/ &#20;&quot;foo.cpp&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(f);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;#include &#20;&lt;string&gt;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;class &#20;Foo &#20;{\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;public:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;int &#20;x() &#20;const;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;};\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;class &#20;Bar &#20;{\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;public:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;void &#20;ping();\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;};\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;patch &#20;= &#20;tmp &#20;/ &#20;&quot;patch_class.txt&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(patch);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;=== &#20;file: &#20;&quot; &#20;&lt;&lt; &#20;f.string()<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&lt;&lt; &#20;&quot; &#20;===\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;--- &#20;replace-cpp-class &#20;Foo\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;class &#20;Foo &#20;{\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;public:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;int &#20;y() &#20;const &#20;{ &#20;return &#20;42; &#20;}\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;};\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;=END=\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(run_apply(patch) &#20;== &#20;0);<br>
<br>
 &#20; &#20; &#20; &#20;auto &#20;L &#20;= &#20;read_lines(f);<br>
 &#20; &#20; &#20; &#20;REQUIRE(L.size() &#20;&gt;= &#20;8);<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(L[0] &#20;== &#20;&quot;#include &#20;&lt;string&gt;&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[1] &#20;== &#20;&quot;&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[2] &#20;== &#20;&quot;class &#20;Foo &#20;{&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[3] &#20;== &#20;&quot;public:&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[4] &#20;== &#20;&quot; &#20; &#20; &#20; &#20;int &#20;y() &#20;const &#20;{ &#20;return &#20;42; &#20;}&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[5] &#20;== &#20;&quot;};&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[6] &#20;== &#20;&quot;&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[7] &#20;== &#20;&quot;class &#20;Bar &#20;{&quot;);<br>
}<br>
<br>
// &#20;============================================================================<br>
// &#20;C++: &#20;replace-cpp-method<br>
// &#20;============================================================================<br>
TEST_CASE(&quot;symbol &#20;API: &#20;replace-cpp-method &#20;by &#20;separate &#20;class &#20;and &#20;method &#20;name&quot;)<br>
{<br>
 &#20; &#20; &#20; &#20;fs::path &#20;tmp &#20;= &#20;fs::temp_directory_path() &#20;/ &#20;&quot;symbol_cpp_method_1&quot;;<br>
 &#20; &#20; &#20; &#20;fs::remove_all(tmp);<br>
 &#20; &#20; &#20; &#20;fs::create_directories(tmp);<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;f &#20;= &#20;tmp &#20;/ &#20;&quot;foo.cpp&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(f);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;class &#20;Foo &#20;{\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;public:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;void &#20;a();\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;int &#20;value() &#20;const;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;};\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;patch &#20;= &#20;tmp &#20;/ &#20;&quot;patch_method1.txt&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(patch);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;=== &#20;file: &#20;&quot; &#20;&lt;&lt; &#20;f.string()<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&lt;&lt; &#20;&quot; &#20;===\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;--- &#20;replace-cpp-method &#20;Foo &#20;value\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;int &#20;value() &#20;const &#20;{ &#20;return &#20;10; &#20;}\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;=END=\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(run_apply(patch) &#20;== &#20;0);<br>
<br>
 &#20; &#20; &#20; &#20;auto &#20;L &#20;= &#20;read_lines(f);<br>
 &#20; &#20; &#20; &#20;REQUIRE(L.size() &#20;== &#20;5);<br>
 &#20; &#20; &#20; &#20;CHECK(L[0] &#20;== &#20;&quot;class &#20;Foo &#20;{&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[1] &#20;== &#20;&quot;public:&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[2] &#20;== &#20;&quot; &#20; &#20; &#20; &#20;void &#20;a();&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[3] &#20;== &#20;&quot; &#20; &#20; &#20; &#20;int &#20;value() &#20;const &#20;{ &#20;return &#20;10; &#20;}&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[4] &#20;== &#20;&quot;};&quot;);<br>
}<br>
<br>
TEST_CASE(&quot;symbol &#20;API: &#20;replace-cpp-method &#20;with &#20;Class::method &#20;syntax&quot;)<br>
{<br>
 &#20; &#20; &#20; &#20;fs::path &#20;tmp &#20;= &#20;fs::temp_directory_path() &#20;/ &#20;&quot;symbol_cpp_method_2&quot;;<br>
 &#20; &#20; &#20; &#20;fs::remove_all(tmp);<br>
 &#20; &#20; &#20; &#20;fs::create_directories(tmp);<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;f &#20;= &#20;tmp &#20;/ &#20;&quot;bar.cpp&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(f);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;class &#20;Bar &#20;{\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;public:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;int &#20;calc(int &#20;x) &#20;const;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;int &#20;other() &#20;const;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;};\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;patch &#20;= &#20;tmp &#20;/ &#20;&quot;patch_method2.txt&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(patch);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;=== &#20;file: &#20;&quot; &#20;&lt;&lt; &#20;f.string()<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&lt;&lt; &#20;&quot; &#20;===\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;--- &#20;replace-cpp-method &#20;Bar::calc\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;int &#20;calc(int &#20;x) &#20;const &#20;{ &#20;return &#20;x &#20;* &#20;2; &#20;}\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;=END=\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(run_apply(patch) &#20;== &#20;0);<br>
<br>
 &#20; &#20; &#20; &#20;auto &#20;L &#20;= &#20;read_lines(f);<br>
 &#20; &#20; &#20; &#20;REQUIRE(L.size() &#20;== &#20;5);<br>
 &#20; &#20; &#20; &#20;CHECK(L[2] &#20;== &#20;&quot; &#20; &#20; &#20; &#20;int &#20;calc(int &#20;x) &#20;const &#20;{ &#20;return &#20;x &#20;* &#20;2; &#20;}&quot;);<br>
 &#20; &#20; &#20; &#20;CHECK(L[3] &#20;== &#20;&quot; &#20; &#20; &#20; &#20;int &#20;other() &#20;const;&quot;);<br>
}<br>
<br>
// &#20;============================================================================<br>
// &#20;Python: &#20;replace-py-class<br>
// &#20;============================================================================<br>
TEST_CASE(&quot;symbol &#20;API: &#20;replace-py-class &#20;replaces &#20;whole &#20;class &#20;body&quot;)<br>
{<br>
 &#20; &#20; &#20; &#20;fs::path &#20;tmp &#20;= &#20;fs::temp_directory_path() &#20;/ &#20;&quot;symbol_py_class&quot;;<br>
 &#20; &#20; &#20; &#20;fs::remove_all(tmp);<br>
 &#20; &#20; &#20; &#20;fs::create_directories(tmp);<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;f &#20;= &#20;tmp &#20;/ &#20;&quot;foo.py&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(f);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;class &#20;Foo:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;def &#20;__init__(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;self.x &#20;= &#20;1\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;class &#20;Bar:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;pass\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;patch &#20;= &#20;tmp &#20;/ &#20;&quot;patch_py_class.txt&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(patch);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;=== &#20;file: &#20;&quot; &#20;&lt;&lt; &#20;f.string()<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&lt;&lt; &#20;&quot; &#20;===\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;--- &#20;replace-py-class &#20;Foo\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;class &#20;Foo:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;def &#20;__init__(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;self.x &#20;= &#20;2\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;def &#20;answer(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;42\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;=END=\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(run_apply(patch) &#20;== &#20;0);<br>
<br>
 &#20; &#20; &#20; &#20;auto &#20;L &#20;= &#20;read_lines(f);<br>
 &#20; &#20; &#20; &#20;REQUIRE(L.size() &#20;&gt;= &#20;5);<br>
<br>
 &#20; &#20; &#20; &#20;// &#20;Проверяем, &#20;что &#20;новый &#20;класс &#20;Foo &#20;на &#20;месте<br>
 &#20; &#20; &#20; &#20;CHECK(L[0] &#20;== &#20;&quot;class &#20;Foo:&quot;);<br>
<br>
 &#20; &#20; &#20; &#20;bool &#20;found_init &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;found_x2 &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;found_answer &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;found_ret42 &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;found_bar &#20;= &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20;for &#20;(const &#20;auto &#20;&amp;line &#20;: &#20;L)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;def &#20;__init__&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_init &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;self.x &#20;= &#20;2&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_x2 &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;def &#20;answer&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_answer &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;return &#20;42&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_ret42 &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line &#20;== &#20;&quot;class &#20;Bar:&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_bar &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(found_init);<br>
 &#20; &#20; &#20; &#20;CHECK(found_x2);<br>
 &#20; &#20; &#20; &#20;CHECK(found_answer);<br>
 &#20; &#20; &#20; &#20;CHECK(found_ret42);<br>
 &#20; &#20; &#20; &#20;CHECK(found_bar);<br>
}<br>
<br>
// &#20;============================================================================<br>
// &#20;Python: &#20;replace-py-method<br>
// &#20;============================================================================<br>
TEST_CASE(&quot;symbol &#20;API: &#20;replace-py-method &#20;with &#20;separate &#20;class &#20;and &#20;method &#20;name&quot;)<br>
{<br>
 &#20; &#20; &#20; &#20;fs::path &#20;tmp &#20;= &#20;fs::temp_directory_path() &#20;/ &#20;&quot;symbol_py_method_1&quot;;<br>
 &#20; &#20; &#20; &#20;fs::remove_all(tmp);<br>
 &#20; &#20; &#20; &#20;fs::create_directories(tmp);<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;f &#20;= &#20;tmp &#20;/ &#20;&quot;weird.py&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(f);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;class &#20;Weird:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;def &#20;run(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;1\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;def &#20;other(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;2\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;patch &#20;= &#20;tmp &#20;/ &#20;&quot;patch_py_method1.txt&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(patch);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;=== &#20;file: &#20;&quot; &#20;&lt;&lt; &#20;f.string()<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&lt;&lt; &#20;&quot; &#20;===\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;--- &#20;replace-py-method &#20;Weird &#20;run\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;def &#20;run(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;100\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;=END=\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(run_apply(patch) &#20;== &#20;0);<br>
<br>
 &#20; &#20; &#20; &#20;auto &#20;L &#20;= &#20;read_lines(f);<br>
 &#20; &#20; &#20; &#20;REQUIRE(L.size() &#20;&gt;= &#20;5);<br>
<br>
 &#20; &#20; &#20; &#20;bool &#20;found_run_100 &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;found_other_2 &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;seen_def_run &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;seen_return_100 &#20;= &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20;for &#20;(const &#20;auto &#20;&amp;line &#20;: &#20;L)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;def &#20;run&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;seen_def_run &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;return &#20;100&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;seen_return_100 &#20;= &#20;true;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;def &#20;other&quot;) &#20;!= &#20;std::string::npos &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;line.find(&quot;return &#20;2&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Очень &#20;грубо: &#20;убеждаемся, &#20;что &#20;следы &#20;second &#20;метода &#20;остались<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_other_2 &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;found_run_100 &#20;= &#20;seen_def_run &#20;&amp;&amp; &#20;seen_return_100;<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(found_run_100);<br>
 &#20; &#20; &#20; &#20;CHECK(found_other_2);<br>
}<br>
<br>
TEST_CASE(&quot;symbol &#20;API: &#20;replace-py-method &#20;with &#20;Class.method &#20;syntax&quot;)<br>
{<br>
 &#20; &#20; &#20; &#20;fs::path &#20;tmp &#20;= &#20;fs::temp_directory_path() &#20;/ &#20;&quot;symbol_py_method_2&quot;;<br>
 &#20; &#20; &#20; &#20;fs::remove_all(tmp);<br>
 &#20; &#20; &#20; &#20;fs::create_directories(tmp);<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;f &#20;= &#20;tmp &#20;/ &#20;&quot;async_foo.py&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(f);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;class &#20;Foo:\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;async &#20;def &#20;bar(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;1\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;fs::path &#20;patch &#20;= &#20;tmp &#20;/ &#20;&quot;patch_py_method2.txt&quot;;<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::ofstream &#20;out(patch);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out &#20;&lt;&lt; &#20;&quot;=== &#20;file: &#20;&quot; &#20;&lt;&lt; &#20;f.string()<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&lt;&lt; &#20;&quot; &#20;===\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;--- &#20;replace-py-method &#20;Foo.bar\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20;async &#20;def &#20;bar(self):\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;2\n&quot;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;&quot;=END=\n&quot;;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(run_apply(patch) &#20;== &#20;0);<br>
<br>
 &#20; &#20; &#20; &#20;auto &#20;L &#20;= &#20;read_lines(f);<br>
 &#20; &#20; &#20; &#20;REQUIRE(L.size() &#20;&gt;= &#20;2);<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(L[0] &#20;== &#20;&quot;class &#20;Foo:&quot;);<br>
<br>
 &#20; &#20; &#20; &#20;bool &#20;found_bar_2 &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;for &#20;(const &#20;auto &#20;&amp;line &#20;: &#20;L)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;async &#20;def &#20;bar&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_bar_2 &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.find(&quot;return &#20;2&quot;) &#20;!= &#20;std::string::npos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;found_bar_2 &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;CHECK(found_bar_2);<br>
}<br>
<!-- END SCAT CODE -->
</body>
</html>
