<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>src/symbols.cpp</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#include &#20;&quot;symbols.h&quot;<br>
<br>
#include &#20;&lt;cctype&gt;<br>
<br>
CppSymbolFinder::CppSymbolFinder(const &#20;std::string &#20;&amp;text)<br>
{<br>
 &#20; &#20; &#20; &#20;// &#20;Разбиваем &#20;текст &#20;на &#20;строки &#20;(независимо &#20;от &#20;\r\n &#20;/ &#20;\n)<br>
 &#20; &#20; &#20; &#20;std::string &#20;current;<br>
 &#20; &#20; &#20; &#20;current.reserve(80);<br>
<br>
 &#20; &#20; &#20; &#20;for &#20;(char &#20;c &#20;: &#20;text)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'\n')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;m_lines.push_back(current);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;current.clear();<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(c &#20;!= &#20;'\r')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;current.push_back(c);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20;m_lines.push_back(current);<br>
<br>
 &#20; &#20; &#20; &#20;tokenize(text);<br>
}<br>
<br>
bool &#20;CppSymbolFinder::is_ident_start(char &#20;c)<br>
{<br>
 &#20; &#20; &#20; &#20;unsigned &#20;char &#20;uc &#20;= &#20;static_cast&lt;unsigned &#20;char&gt;(c);<br>
 &#20; &#20; &#20; &#20;return &#20;std::isalpha(uc) &#20;|| &#20;c &#20;== &#20;'_';<br>
}<br>
<br>
bool &#20;CppSymbolFinder::is_ident_char(char &#20;c)<br>
{<br>
 &#20; &#20; &#20; &#20;unsigned &#20;char &#20;uc &#20;= &#20;static_cast&lt;unsigned &#20;char&gt;(c);<br>
 &#20; &#20; &#20; &#20;return &#20;std::isalnum(uc) &#20;|| &#20;c &#20;== &#20;'_';<br>
}<br>
<br>
void &#20;CppSymbolFinder::tokenize(const &#20;std::string &#20;&amp;text)<br>
{<br>
 &#20; &#20; &#20; &#20;m_tokens.clear();<br>
<br>
 &#20; &#20; &#20; &#20;bool &#20;in_block_comment &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;in_string &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20;bool &#20;in_char &#20;= &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20;int &#20;line &#20;= &#20;0;<br>
 &#20; &#20; &#20; &#20;const &#20;std::size_t &#20;n &#20;= &#20;text.size();<br>
<br>
 &#20; &#20; &#20; &#20;for &#20;(std::size_t &#20;i &#20;= &#20;0; &#20;i &#20;&lt; &#20;n;)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;char &#20;c &#20;= &#20;text[i];<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'\n')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(in_block_comment)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'*' &#20;&amp;&amp; &#20;i &#20;+ &#20;1 &#20;&lt; &#20;n &#20;&amp;&amp; &#20;text[i &#20;+ &#20;1] &#20;== &#20;'/')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;in_block_comment &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;i &#20;+= &#20;2;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(in_string &#20;|| &#20;in_char)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'\\' &#20;&amp;&amp; &#20;i &#20;+ &#20;1 &#20;&lt; &#20;n)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;i &#20;+= &#20;2; &#20;// &#20;экранированный &#20;символ<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(in_string &#20;&amp;&amp; &#20;c &#20;== &#20;'&quot;')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;in_string &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(in_char &#20;&amp;&amp; &#20;c &#20;== &#20;'\'')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;in_char &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Пробелы<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;' &#20;' &#20;|| &#20;c &#20;== &#20;'\t' &#20;|| &#20;c &#20;== &#20;'\r' &#20;|| &#20;c &#20;== &#20;'\f' &#20;|| &#20;c &#20;== &#20;'\v')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Препроцессорная &#20;директива: &#20;пропускаем &#20;всю &#20;строку<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'#' &#20;&amp;&amp; &#20;(i &#20;== &#20;0 &#20;|| &#20;text[i &#20;- &#20;1] &#20;== &#20;'\n'))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(i &#20;&lt; &#20;n &#20;&amp;&amp; &#20;text[i] &#20;!= &#20;'\n')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Однострочный &#20;комментарий &#20;//<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'/' &#20;&amp;&amp; &#20;i &#20;+ &#20;1 &#20;&lt; &#20;n &#20;&amp;&amp; &#20;text[i &#20;+ &#20;1] &#20;== &#20;'/')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(i &#20;&lt; &#20;n &#20;&amp;&amp; &#20;text[i] &#20;!= &#20;'\n')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Блочный &#20;комментарий &#20;/* &#20;... &#20;*/<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'/' &#20;&amp;&amp; &#20;i &#20;+ &#20;1 &#20;&lt; &#20;n &#20;&amp;&amp; &#20;text[i &#20;+ &#20;1] &#20;== &#20;'*')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;in_block_comment &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;i &#20;+= &#20;2;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Строковый &#20;литерал<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'&quot;')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;in_string &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Символьный &#20;литерал<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'\'')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;in_char &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Идентификатор &#20;/ &#20;ключевое &#20;слово<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(is_ident_start(c))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;start &#20;= &#20;i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(i &#20;&lt; &#20;n &#20;&amp;&amp; &#20;is_ident_char(text[i]))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::string &#20;ident &#20;= &#20;text.substr(start, &#20;i &#20;- &#20;start);<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Token &#20;tok;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.text &#20;= &#20;ident;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.line &#20;= &#20;line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ident &#20;== &#20;&quot;class&quot; &#20;|| &#20;ident &#20;== &#20;&quot;struct&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.kind &#20;= &#20;Token::Keyword;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.kind &#20;= &#20;Token::Identifier;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;m_tokens.push_back(std::move(tok));<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Двойное &#20;двоеточие &#20;::<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;':' &#20;&amp;&amp; &#20;i &#20;+ &#20;1 &#20;&lt; &#20;n &#20;&amp;&amp; &#20;text[i &#20;+ &#20;1] &#20;== &#20;':')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Token &#20;tok;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.kind &#20;= &#20;Token::Symbol;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.text &#20;= &#20;&quot;::&quot;;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.line &#20;= &#20;line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;m_tokens.push_back(std::move(tok));<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;i &#20;+= &#20;2;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Любой &#20;пунктуационный &#20;символ &#20;как &#20;отдельный &#20;токен<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(std::ispunct(static_cast&lt;unsigned &#20;char&gt;(c)))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Token &#20;tok;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.kind &#20;= &#20;Token::Symbol;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.text &#20;= &#20;std::string(1, &#20;c);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;tok.line &#20;= &#20;line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;m_tokens.push_back(std::move(tok));<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;На &#20;всякий &#20;случай: &#20;пропускаем &#20;остальные &#20;символы<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20;}<br>
}<br>
<br>
bool &#20;CppSymbolFinder::find_class_internal(const &#20;std::string &#20;&amp;class_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;ClassRange &#20;&amp;out) &#20;const<br>
{<br>
 &#20; &#20; &#20; &#20;const &#20;std::size_t &#20;n &#20;= &#20;m_tokens.size();<br>
<br>
 &#20; &#20; &#20; &#20;for &#20;(std::size_t &#20;i &#20;= &#20;0; &#20;i &#20;&lt; &#20;n; &#20;++i)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;Token &#20;&amp;t &#20;= &#20;m_tokens[i];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(t.kind &#20;!= &#20;Token::Keyword)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(t.text &#20;!= &#20;&quot;class&quot; &#20;&amp;&amp; &#20;t.text &#20;!= &#20;&quot;struct&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Ищем &#20;первое &#20;имя &#20;после &#20;class/struct<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;j &#20;= &#20;i &#20;+ &#20;1;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(j &#20;&lt; &#20;n &#20;&amp;&amp; &#20;m_tokens[j].kind &#20;!= &#20;Token::Identifier)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++j;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(j &#20;&gt;= &#20;n)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;Token &#20;&amp;name_tok &#20;= &#20;m_tokens[j];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(name_tok.text &#20;!= &#20;class_name)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Определение &#20;или &#20;forward-declaration?<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Смотрим &#20;только &#20;до &#20;первой &#20;';' &#20;или &#20;'{' &#20;после &#20;имени.<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;k &#20;= &#20;j &#20;+ &#20;1;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;bool &#20;saw_lbrace &#20;= &#20;false;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(; &#20;k &#20;&lt; &#20;n; &#20;++k)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;Token &#20;&amp;tk &#20;= &#20;m_tokens[k];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(tk.text &#20;== &#20;&quot;{&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;saw_lbrace &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(tk.text &#20;== &#20;&quot;;&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;forward-decl: &#20;встретили &#20;';' &#20;раньше &#20;'{'<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Если &#20;до &#20;';' &#20;так &#20;и &#20;не &#20;встретили &#20;'{', &#20;это &#20;forward-declaration.<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(!saw_lbrace)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Ищем &#20;соответствующую &#20;закрывающую &#20;'}'<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;depth &#20;= &#20;1;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;body_start &#20;= &#20;k;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;body_end &#20;= &#20;k;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(std::size_t &#20;p &#20;= &#20;k &#20;+ &#20;1; &#20;p &#20;&lt; &#20;n; &#20;++p)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;Token &#20;&amp;tp &#20;= &#20;m_tokens[p];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(tp.text &#20;== &#20;&quot;{&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++depth;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(tp.text &#20;== &#20;&quot;}&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;--depth;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(depth &#20;== &#20;0)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;body_end &#20;= &#20;p;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Захватываем &#20;возможное &#20;';' &#20;после &#20;'}' &#20;(class &#20;Foo &#20;{...};)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;q &#20;= &#20;p &#20;+ &#20;1;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(q &#20;&lt; &#20;n &#20;&amp;&amp; &#20;m_tokens[q].text &#20;== &#20;&quot;;&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;body_end &#20;= &#20;q;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.region.start_line &#20;= &#20;t.line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.region.end_line &#20;= &#20;m_tokens[body_end].line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.body_start_token &#20;= &#20;body_start;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.body_end_token &#20;= &#20;body_end;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;return &#20;false;<br>
}<br>
<br>
bool &#20;CppSymbolFinder::find_class(const &#20;std::string &#20;&amp;class_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Region &#20;&amp;out) &#20;const<br>
{<br>
 &#20; &#20; &#20; &#20;ClassRange &#20;cr;<br>
 &#20; &#20; &#20; &#20;if &#20;(!find_class_internal(class_name, &#20;cr))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20;out &#20;= &#20;cr.region;<br>
 &#20; &#20; &#20; &#20;return &#20;true;<br>
}<br>
<br>
bool &#20;CppSymbolFinder::find_method(const &#20;std::string &#20;&amp;class_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;method_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Region &#20;&amp;out) &#20;const<br>
{<br>
 &#20; &#20; &#20; &#20;ClassRange &#20;cr;<br>
 &#20; &#20; &#20; &#20;if &#20;(!find_class_internal(class_name, &#20;cr))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20;const &#20;std::size_t &#20;begin &#20;= &#20;cr.body_start_token &#20;+ &#20;1;<br>
 &#20; &#20; &#20; &#20;const &#20;std::size_t &#20;end &#20;= &#20;cr.body_end_token;<br>
 &#20; &#20; &#20; &#20;const &#20;std::size_t &#20;n &#20;= &#20;m_tokens.size();<br>
<br>
 &#20; &#20; &#20; &#20;if &#20;(begin &#20;&gt;= &#20;n &#20;|| &#20;begin &#20;&gt;= &#20;end)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20;// &#20;Ищем &#20;внутри &#20;тела &#20;класса<br>
 &#20; &#20; &#20; &#20;for &#20;(std::size_t &#20;i &#20;= &#20;begin; &#20;i &#20;&lt; &#20;end; &#20;++i)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;Token &#20;&amp;t &#20;= &#20;m_tokens[i];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(t.kind &#20;!= &#20;Token::Identifier)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(t.text &#20;!= &#20;method_name)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;После &#20;имени &#20;должен &#20;идти &#20;'('<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;j &#20;= &#20;i &#20;+ &#20;1;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(j &#20;&gt;= &#20;end &#20;|| &#20;m_tokens[j].text &#20;!= &#20;&quot;(&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Определяем &#20;начало &#20;объявления:<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;идём &#20;назад &#20;до &#20;ближайшего &#20;';', &#20;'{' &#20;или &#20;'}'.<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;start_tok &#20;= &#20;begin;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(std::size_t &#20;k &#20;= &#20;i; &#20;k &#20;&gt; &#20;begin; &#20;--k)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;s &#20;= &#20;m_tokens[k].text;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(s &#20;== &#20;&quot;;&quot; &#20;|| &#20;s &#20;== &#20;&quot;{&quot; &#20;|| &#20;s &#20;== &#20;&quot;}&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;start_tok &#20;= &#20;k &#20;+ &#20;1;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;1) &#20;Пропускаем &#20;параметры &#20;(балансируем &#20;скобки)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;pos &#20;= &#20;j;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;paren_depth &#20;= &#20;0;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(; &#20;pos &#20;&lt; &#20;end; &#20;++pos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;s &#20;= &#20;m_tokens[pos].text;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(s &#20;== &#20;&quot;(&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++paren_depth;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(s &#20;== &#20;&quot;)&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;--paren_depth;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(paren_depth &#20;== &#20;0)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++pos; &#20;// &#20;идём &#20;на &#20;токен &#20;после &#20;')'<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(paren_depth &#20;!= &#20;0)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue; &#20;// &#20;сломанная &#20;сигнатура<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;2) &#20;Ищем &#20;';' &#20;или &#20;'{' &#20;(начало &#20;тела)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;end_tok &#20;= &#20;start_tok;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;brace_depth &#20;= &#20;0;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(; &#20;pos &#20;&lt; &#20;end; &#20;++pos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;s &#20;= &#20;m_tokens[pos].text;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(s &#20;== &#20;&quot;;&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;end_tok &#20;= &#20;pos;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(s &#20;== &#20;&quot;{&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;brace_depth &#20;= &#20;1;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;end_tok &#20;= &#20;pos;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++pos;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(; &#20;pos &#20;&lt; &#20;end; &#20;++pos)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;sb &#20;= &#20;m_tokens[pos].text;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(sb &#20;== &#20;&quot;{&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++brace_depth;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(sb &#20;== &#20;&quot;}&quot;)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;--brace_depth;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(brace_depth &#20;== &#20;0)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;end_tok &#20;= &#20;pos;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(end_tok &#20;&lt; &#20;start_tok)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;start_line_token &#20;= &#20;m_tokens[start_tok].line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;method_line &#20;= &#20;t.line;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Не &#20;вываливаемся &#20;на &#20;строку &#20;с &#20;access-specifier'ом &#20;(public:)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.start_line &#20;=<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(start_line_token &#20;&lt; &#20;method_line) &#20;? &#20;method_line &#20;: &#20;start_line_token;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.end_line &#20;= &#20;m_tokens[end_tok].line;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;true;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;return &#20;false;<br>
}<br>
<!-- END SCAT CODE -->
</body>
</html>
