<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>src/symbols_py.cpp</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#include &#20;&quot;symbols.h&quot;<br>
<br>
#include &#20;&lt;cctype&gt;<br>
<br>
PythonSymbolFinder::PythonSymbolFinder(const &#20;std::string &#20;&amp;text)<br>
{<br>
 &#20; &#20; &#20; &#20;m_lines.clear();<br>
 &#20; &#20; &#20; &#20;std::string &#20;current;<br>
 &#20; &#20; &#20; &#20;current.reserve(80);<br>
<br>
 &#20; &#20; &#20; &#20;for &#20;(char &#20;c &#20;: &#20;text)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;'\n')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;m_lines.push_back(current);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;current.clear();<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(c &#20;!= &#20;'\r')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;current.push_back(c);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20;m_lines.push_back(current);<br>
}<br>
<br>
int &#20;PythonSymbolFinder::calc_indent(const &#20;std::string &#20;&amp;line)<br>
{<br>
 &#20; &#20; &#20; &#20;int &#20;indent &#20;= &#20;0;<br>
 &#20; &#20; &#20; &#20;for &#20;(char &#20;c &#20;: &#20;line)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(c &#20;== &#20;' &#20;')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++indent;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(c &#20;== &#20;'\t')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;indent &#20;+= &#20;4; &#20;// &#20;грубая &#20;оценка, &#20;но &#20;устойчиво &#20;для &#20;сравнения<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20;return &#20;indent;<br>
}<br>
<br>
std::size_t &#20;PythonSymbolFinder::first_code_pos(const &#20;std::string &#20;&amp;line)<br>
{<br>
 &#20; &#20; &#20; &#20;std::size_t &#20;i &#20;= &#20;0;<br>
 &#20; &#20; &#20; &#20;while &#20;(i &#20;&lt; &#20;line.size() &#20;&amp;&amp; &#20;(line[i] &#20;== &#20;' &#20;' &#20;|| &#20;line[i] &#20;== &#20;'\t'))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++i;<br>
 &#20; &#20; &#20; &#20;return &#20;i;<br>
}<br>
<br>
bool &#20;PythonSymbolFinder::find_class_internal(const &#20;std::string &#20;&amp;class_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Region &#20;&amp;out,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;&amp;class_indent) &#20;const<br>
{<br>
 &#20; &#20; &#20; &#20;const &#20;int &#20;n &#20;= &#20;static_cast&lt;int&gt;(m_lines.size());<br>
 &#20; &#20; &#20; &#20;for &#20;(int &#20;i &#20;= &#20;0; &#20;i &#20;&lt; &#20;n; &#20;++i)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;line &#20;= &#20;m_lines[static_cast&lt;std::size_t&gt;(i)];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;pos &#20;= &#20;first_code_pos(line);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(pos &#20;&gt;= &#20;line.size())<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;комментарии &#20;/ &#20;shebang<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line[pos] &#20;== &#20;'#')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.compare(pos, &#20;5, &#20;&quot;class&quot;) &#20;!= &#20;0)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;char &#20;after &#20;= &#20;(pos &#20;+ &#20;5 &#20;&lt; &#20;line.size()) &#20;? &#20;line[pos &#20;+ &#20;5] &#20;: &#20;'\0';<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(!(after &#20;== &#20;'\0' &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(after)) &#20;|| &#20;after &#20;== &#20;'(' &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;after &#20;== &#20;':'))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;p &#20;= &#20;pos &#20;+ &#20;5;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(p &#20;&lt; &#20;line.size() &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(line[p])))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++p;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;name_start &#20;= &#20;p;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(p &#20;&lt; &#20;line.size() &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(std::isalnum(static_cast&lt;unsigned &#20;char&gt;(line[p])) &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;line[p] &#20;== &#20;'_'))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++p;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(name_start &#20;== &#20;p)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::string &#20;name &#20;= &#20;line.substr(name_start, &#20;p &#20;- &#20;name_start);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(name &#20;!= &#20;class_name)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;class_indent &#20;= &#20;calc_indent(line);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;last_body &#20;= &#20;i;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(int &#20;k &#20;= &#20;i &#20;+ &#20;1; &#20;k &#20;&lt; &#20;n; &#20;++k)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;l2 &#20;= &#20;m_lines[static_cast&lt;std::size_t&gt;(k)];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;pos2 &#20;= &#20;first_code_pos(l2);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(pos2 &#20;&gt;= &#20;l2.size())<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue; &#20;// &#20;пустая &#20;строка &#20;в &#20;теле<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;ind2 &#20;= &#20;calc_indent(l2);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ind2 &#20;&lt;= &#20;class_indent)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break; &#20;// &#20;dedent &#20;— &#20;выходим &#20;из &#20;класса<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;last_body &#20;= &#20;k;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.start_line &#20;= &#20;i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.end_line &#20;= &#20;last_body;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;true;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;return &#20;false;<br>
}<br>
<br>
bool &#20;PythonSymbolFinder::find_class(const &#20;std::string &#20;&amp;class_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Region &#20;&amp;out) &#20;const<br>
{<br>
 &#20; &#20; &#20; &#20;int &#20;indent &#20;= &#20;0;<br>
 &#20; &#20; &#20; &#20;return &#20;find_class_internal(class_name, &#20;out, &#20;indent);<br>
}<br>
<br>
bool &#20;PythonSymbolFinder::find_method(const &#20;std::string &#20;&amp;class_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;method_name,<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;Region &#20;&amp;out) &#20;const<br>
{<br>
 &#20; &#20; &#20; &#20;Region &#20;class_region;<br>
 &#20; &#20; &#20; &#20;int &#20;class_indent &#20;= &#20;0;<br>
 &#20; &#20; &#20; &#20;if &#20;(!find_class_internal(class_name, &#20;class_region, &#20;class_indent))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20;const &#20;int &#20;start &#20;= &#20;class_region.start_line;<br>
 &#20; &#20; &#20; &#20;const &#20;int &#20;end &#20;= &#20;class_region.end_line;<br>
<br>
 &#20; &#20; &#20; &#20;// &#20;Определяем &#20;базовый &#20;уровень &#20;отступа &#20;для &#20;членов &#20;класса<br>
 &#20; &#20; &#20; &#20;int &#20;member_indent &#20;= &#20;-1;<br>
 &#20; &#20; &#20; &#20;for &#20;(int &#20;i &#20;= &#20;start &#20;+ &#20;1; &#20;i &#20;&lt;= &#20;end; &#20;++i)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;line &#20;= &#20;m_lines[static_cast&lt;std::size_t&gt;(i)];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;pos &#20;= &#20;first_code_pos(line);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(pos &#20;&gt;= &#20;line.size())<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line[pos] &#20;== &#20;'#')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;ind &#20;= &#20;calc_indent(line);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ind &#20;&lt;= &#20;class_indent)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;member_indent &#20;= &#20;ind;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;if &#20;(member_indent &#20;&lt; &#20;0)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;false; &#20;// &#20;пустой &#20;класс<br>
<br>
 &#20; &#20; &#20; &#20;const &#20;int &#20;n &#20;= &#20;static_cast&lt;int&gt;(m_lines.size());<br>
<br>
 &#20; &#20; &#20; &#20;for &#20;(int &#20;i &#20;= &#20;start &#20;+ &#20;1; &#20;i &#20;&lt;= &#20;end &#20;&amp;&amp; &#20;i &#20;&lt; &#20;n; &#20;++i)<br>
 &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;line &#20;= &#20;m_lines[static_cast&lt;std::size_t&gt;(i)];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;pos &#20;= &#20;first_code_pos(line);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(pos &#20;&gt;= &#20;line.size())<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;ind &#20;= &#20;calc_indent(line);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ind &#20;!= &#20;member_indent)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line[pos] &#20;== &#20;'#')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;def &#20;/ &#20;async &#20;def<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;p &#20;= &#20;pos;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;bool &#20;is_async &#20;= &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.compare(p, &#20;5, &#20;&quot;async&quot;) &#20;== &#20;0 &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(p &#20;+ &#20;5 &#20;&gt;= &#20;line.size() &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(line[p &#20;+ &#20;5]))))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;is_async &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;p &#20;+= &#20;5;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(p &#20;&lt; &#20;line.size() &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(line[p])))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++p;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(line.compare(p, &#20;3, &#20;&quot;def&quot;) &#20;!= &#20;0 &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(p &#20;+ &#20;3 &#20;&lt; &#20;line.size() &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;!std::isspace(static_cast&lt;unsigned &#20;char&gt;(line[p &#20;+ &#20;3]))))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;p &#20;+= &#20;3;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(p &#20;&lt; &#20;line.size() &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(line[p])))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++p;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;name_start &#20;= &#20;p;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(p &#20;&lt; &#20;line.size() &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(std::isalnum(static_cast&lt;unsigned &#20;char&gt;(line[p])) &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;line[p] &#20;== &#20;'_'))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++p;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(name_start &#20;== &#20;p)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::string &#20;name &#20;= &#20;line.substr(name_start, &#20;p &#20;- &#20;name_start);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(name &#20;!= &#20;method_name)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Нашли &#20;нужный &#20;метод<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;decl_start &#20;= &#20;i;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Захватываем &#20;декораторы &#20;над &#20;методом &#20;(тем &#20;же &#20;отступом)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(int &#20;j &#20;= &#20;i &#20;- &#20;1; &#20;j &#20;&gt; &#20;start; &#20;--j)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;pline &#20;= &#20;m_lines[static_cast&lt;std::size_t&gt;(j)];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;ppos &#20;= &#20;first_code_pos(pline);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ppos &#20;&gt;= &#20;pline.size())<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;pind &#20;= &#20;calc_indent(pline);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(pind &#20;!= &#20;member_indent)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(pline[ppos] &#20;!= &#20;'@')<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;decl_start &#20;= &#20;j;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;last_body &#20;= &#20;i;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;for &#20;(int &#20;k &#20;= &#20;i &#20;+ &#20;1; &#20;k &#20;&lt;= &#20;end &#20;&amp;&amp; &#20;k &#20;&lt; &#20;n; &#20;++k)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;const &#20;std::string &#20;&amp;l2 &#20;= &#20;m_lines[static_cast&lt;std::size_t&gt;(k)];<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;pos2 &#20;= &#20;first_code_pos(l2);<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(pos2 &#20;&gt;= &#20;l2.size())<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;continue;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;int &#20;ind2 &#20;= &#20;calc_indent(l2);<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ind2 &#20;&lt;= &#20;class_indent)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break; &#20;// &#20;вышли &#20;из &#20;класса<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ind2 &#20;&lt; &#20;member_indent)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break; &#20;// &#20;вышли &#20;из &#20;метода<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;// &#20;Новый &#20;метод &#20;/ &#20;класс &#20;на &#20;том &#20;же &#20;уровне &#20;— &#20;заканчиваем &#20;текущий<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(ind2 &#20;== &#20;member_indent)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;bool &#20;is_new_block &#20;= &#20;false;<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(l2.compare(pos2, &#20;5, &#20;&quot;class&quot;) &#20;== &#20;0 &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(pos2 &#20;+ &#20;5 &#20;&gt;= &#20;l2.size() &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(l2[pos2 &#20;+ &#20;5]))))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;is_new_block &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(l2.compare(pos2, &#20;3, &#20;&quot;def&quot;) &#20;== &#20;0 &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(pos2 &#20;+ &#20;3 &#20;&gt;= &#20;l2.size() &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;static_cast&lt;unsigned &#20;char&gt;(l2[pos2 &#20;+ &#20;3]))))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;is_new_block &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;else &#20;if &#20;(l2.compare(pos2, &#20;5, &#20;&quot;async&quot;) &#20;== &#20;0)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::size_t &#20;q &#20;= &#20;pos2 &#20;+ &#20;5;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;while &#20;(q &#20;&lt; &#20;l2.size() &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(l2[q])))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;++q;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(l2.compare(q, &#20;3, &#20;&quot;def&quot;) &#20;== &#20;0 &#20;&amp;&amp;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;(q &#20;+ &#20;3 &#20;&gt;= &#20;l2.size() &#20;||<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;std::isspace(static_cast&lt;unsigned &#20;char&gt;(l2[q &#20;+ &#20;3]))))<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;{<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;is_new_block &#20;= &#20;true;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;if &#20;(is_new_block)<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;break;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;last_body &#20;= &#20;k;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.start_line &#20;= &#20;decl_start;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;out.end_line &#20;= &#20;last_body;<br>
 &#20; &#20; &#20; &#20; &#20; &#20; &#20; &#20;return &#20;true;<br>
 &#20; &#20; &#20; &#20;}<br>
<br>
 &#20; &#20; &#20; &#20;return &#20;false;<br>
}<br>
<!-- END SCAT CODE -->
</body>
</html>
