<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>src/symbols_py.cpp</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#include&#32;&quot;symbols.h&quot;<br>
<br>
#include&#32;&lt;cctype&gt;<br>
<br>
PythonSymbolFinder::PythonSymbolFinder(const&#32;std::string&#32;&amp;text)<br>
{<br>
&#32;&#32;&#32;&#32;m_lines.clear();<br>
&#32;&#32;&#32;&#32;std::string&#32;current;<br>
&#32;&#32;&#32;&#32;current.reserve(80);<br>
<br>
&#32;&#32;&#32;&#32;for&#32;(char&#32;c&#32;:&#32;text)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(c&#32;==&#32;'\n')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;m_lines.push_back(current);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;current.clear();<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else&#32;if&#32;(c&#32;!=&#32;'\r')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;current.push_back(c);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;m_lines.push_back(current);<br>
}<br>
<br>
int&#32;PythonSymbolFinder::calc_indent(const&#32;std::string&#32;&amp;line)<br>
{<br>
&#32;&#32;&#32;&#32;int&#32;indent&#32;=&#32;0;<br>
&#32;&#32;&#32;&#32;for&#32;(char&#32;c&#32;:&#32;line)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(c&#32;==&#32;'&#32;')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++indent;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else&#32;if&#32;(c&#32;==&#32;'\t')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;indent&#32;+=&#32;4;&#32;//&#32;грубая&#32;оценка,&#32;но&#32;устойчиво&#32;для&#32;сравнения<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;<br>
&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;return&#32;indent;<br>
}<br>
<br>
std::size_t&#32;PythonSymbolFinder::first_code_pos(const&#32;std::string&#32;&amp;line)<br>
{<br>
&#32;&#32;&#32;&#32;std::size_t&#32;i&#32;=&#32;0;<br>
&#32;&#32;&#32;&#32;while&#32;(i&#32;&lt;&#32;line.size()&#32;&amp;&amp;&#32;(line[i]&#32;==&#32;'&#32;'&#32;||&#32;line[i]&#32;==&#32;'\t'))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++i;<br>
&#32;&#32;&#32;&#32;return&#32;i;<br>
}<br>
<br>
bool&#32;PythonSymbolFinder::find_class_internal(const&#32;std::string&#32;&amp;class_name,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Region&#32;&amp;out,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;&amp;class_indent)&#32;const<br>
{<br>
&#32;&#32;&#32;&#32;const&#32;int&#32;n&#32;=&#32;static_cast&lt;int&gt;(m_lines.size());<br>
&#32;&#32;&#32;&#32;for&#32;(int&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;n;&#32;++i)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;std::string&#32;&amp;line&#32;=&#32;m_lines[static_cast&lt;std::size_t&gt;(i)];<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;pos&#32;=&#32;first_code_pos(line);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pos&#32;&gt;=&#32;line.size())<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;комментарии&#32;/&#32;shebang<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(line[pos]&#32;==&#32;'#')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(line.compare(pos,&#32;5,&#32;&quot;class&quot;)&#32;!=&#32;0)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;char&#32;after&#32;=&#32;(pos&#32;+&#32;5&#32;&lt;&#32;line.size())&#32;?&#32;line[pos&#32;+&#32;5]&#32;:&#32;'\0';<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(!(after&#32;==&#32;'\0'&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(after))&#32;||&#32;after&#32;==&#32;'('&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;after&#32;==&#32;':'))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;p&#32;=&#32;pos&#32;+&#32;5;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;while&#32;(p&#32;&lt;&#32;line.size()&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(line[p])))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++p;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;name_start&#32;=&#32;p;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;while&#32;(p&#32;&lt;&#32;line.size()&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(std::isalnum(static_cast&lt;unsigned&#32;char&gt;(line[p]))&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;line[p]&#32;==&#32;'_'))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++p;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(name_start&#32;==&#32;p)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::string&#32;name&#32;=&#32;line.substr(name_start,&#32;p&#32;-&#32;name_start);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(name&#32;!=&#32;class_name)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;class_indent&#32;=&#32;calc_indent(line);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;last_body&#32;=&#32;i;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;for&#32;(int&#32;k&#32;=&#32;i&#32;+&#32;1;&#32;k&#32;&lt;&#32;n;&#32;++k)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;std::string&#32;&amp;l2&#32;=&#32;m_lines[static_cast&lt;std::size_t&gt;(k)];<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;pos2&#32;=&#32;first_code_pos(l2);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pos2&#32;&gt;=&#32;l2.size())<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;&#32;//&#32;пустая&#32;строка&#32;в&#32;теле<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;ind2&#32;=&#32;calc_indent(l2);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(ind2&#32;&lt;=&#32;class_indent)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;&#32;//&#32;dedent&#32;—&#32;выходим&#32;из&#32;класса<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;last_body&#32;=&#32;k;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;out.start_line&#32;=&#32;i;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;out.end_line&#32;=&#32;last_body;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;true;<br>
&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;return&#32;false;<br>
}<br>
<br>
bool&#32;PythonSymbolFinder::find_class(const&#32;std::string&#32;&amp;class_name,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Region&#32;&amp;out)&#32;const<br>
{<br>
&#32;&#32;&#32;&#32;int&#32;indent&#32;=&#32;0;<br>
&#32;&#32;&#32;&#32;return&#32;find_class_internal(class_name,&#32;out,&#32;indent);<br>
}<br>
<br>
bool&#32;PythonSymbolFinder::find_method(const&#32;std::string&#32;&amp;class_name,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;std::string&#32;&amp;method_name,<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Region&#32;&amp;out)&#32;const<br>
{<br>
&#32;&#32;&#32;&#32;Region&#32;class_region;<br>
&#32;&#32;&#32;&#32;int&#32;class_indent&#32;=&#32;0;<br>
&#32;&#32;&#32;&#32;if&#32;(!find_class_internal(class_name,&#32;class_region,&#32;class_indent))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;false;<br>
<br>
&#32;&#32;&#32;&#32;const&#32;int&#32;start&#32;=&#32;class_region.start_line;<br>
&#32;&#32;&#32;&#32;const&#32;int&#32;end&#32;=&#32;class_region.end_line;<br>
<br>
&#32;&#32;&#32;&#32;//&#32;Определяем&#32;базовый&#32;уровень&#32;отступа&#32;для&#32;членов&#32;класса<br>
&#32;&#32;&#32;&#32;int&#32;member_indent&#32;=&#32;-1;<br>
&#32;&#32;&#32;&#32;for&#32;(int&#32;i&#32;=&#32;start&#32;+&#32;1;&#32;i&#32;&lt;=&#32;end;&#32;++i)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;std::string&#32;&amp;line&#32;=&#32;m_lines[static_cast&lt;std::size_t&gt;(i)];<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;pos&#32;=&#32;first_code_pos(line);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pos&#32;&gt;=&#32;line.size())<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(line[pos]&#32;==&#32;'#')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;ind&#32;=&#32;calc_indent(line);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(ind&#32;&lt;=&#32;class_indent)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;member_indent&#32;=&#32;ind;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;<br>
&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;if&#32;(member_indent&#32;&lt;&#32;0)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;false;&#32;//&#32;пустой&#32;класс<br>
<br>
&#32;&#32;&#32;&#32;const&#32;int&#32;n&#32;=&#32;static_cast&lt;int&gt;(m_lines.size());<br>
<br>
&#32;&#32;&#32;&#32;for&#32;(int&#32;i&#32;=&#32;start&#32;+&#32;1;&#32;i&#32;&lt;=&#32;end&#32;&amp;&amp;&#32;i&#32;&lt;&#32;n;&#32;++i)<br>
&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;std::string&#32;&amp;line&#32;=&#32;m_lines[static_cast&lt;std::size_t&gt;(i)];<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;pos&#32;=&#32;first_code_pos(line);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pos&#32;&gt;=&#32;line.size())<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;ind&#32;=&#32;calc_indent(line);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(ind&#32;!=&#32;member_indent)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(line[pos]&#32;==&#32;'#')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;def&#32;/&#32;async&#32;def<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;p&#32;=&#32;pos;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bool&#32;is_async&#32;=&#32;false;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(line.compare(p,&#32;5,&#32;&quot;async&quot;)&#32;==&#32;0&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(p&#32;+&#32;5&#32;&gt;=&#32;line.size()&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(line[p&#32;+&#32;5]))))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;is_async&#32;=&#32;true;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;p&#32;+=&#32;5;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;while&#32;(p&#32;&lt;&#32;line.size()&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(line[p])))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++p;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(line.compare(p,&#32;3,&#32;&quot;def&quot;)&#32;!=&#32;0&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(p&#32;+&#32;3&#32;&lt;&#32;line.size()&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;!std::isspace(static_cast&lt;unsigned&#32;char&gt;(line[p&#32;+&#32;3]))))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;p&#32;+=&#32;3;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;while&#32;(p&#32;&lt;&#32;line.size()&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(line[p])))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++p;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;name_start&#32;=&#32;p;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;while&#32;(p&#32;&lt;&#32;line.size()&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(std::isalnum(static_cast&lt;unsigned&#32;char&gt;(line[p]))&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;line[p]&#32;==&#32;'_'))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++p;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(name_start&#32;==&#32;p)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::string&#32;name&#32;=&#32;line.substr(name_start,&#32;p&#32;-&#32;name_start);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(name&#32;!=&#32;method_name)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;Нашли&#32;нужный&#32;метод<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;decl_start&#32;=&#32;i;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;Захватываем&#32;декораторы&#32;над&#32;методом&#32;(тем&#32;же&#32;отступом)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;for&#32;(int&#32;j&#32;=&#32;i&#32;-&#32;1;&#32;j&#32;&gt;&#32;start;&#32;--j)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;std::string&#32;&amp;pline&#32;=&#32;m_lines[static_cast&lt;std::size_t&gt;(j)];<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;ppos&#32;=&#32;first_code_pos(pline);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(ppos&#32;&gt;=&#32;pline.size())<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;pind&#32;=&#32;calc_indent(pline);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pind&#32;!=&#32;member_indent)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pline[ppos]&#32;!=&#32;'@')<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;decl_start&#32;=&#32;j;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;last_body&#32;=&#32;i;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;for&#32;(int&#32;k&#32;=&#32;i&#32;+&#32;1;&#32;k&#32;&lt;=&#32;end&#32;&amp;&amp;&#32;k&#32;&lt;&#32;n;&#32;++k)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;const&#32;std::string&#32;&amp;l2&#32;=&#32;m_lines[static_cast&lt;std::size_t&gt;(k)];<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;pos2&#32;=&#32;first_code_pos(l2);<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(pos2&#32;&gt;=&#32;l2.size())<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;continue;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;int&#32;ind2&#32;=&#32;calc_indent(l2);<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(ind2&#32;&lt;=&#32;class_indent)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;&#32;//&#32;вышли&#32;из&#32;класса<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(ind2&#32;&lt;&#32;member_indent)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;&#32;//&#32;вышли&#32;из&#32;метода<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;Новый&#32;метод&#32;/&#32;класс&#32;на&#32;том&#32;же&#32;уровне&#32;—&#32;заканчиваем&#32;текущий<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(ind2&#32;==&#32;member_indent)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bool&#32;is_new_block&#32;=&#32;false;<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(l2.compare(pos2,&#32;5,&#32;&quot;class&quot;)&#32;==&#32;0&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(pos2&#32;+&#32;5&#32;&gt;=&#32;l2.size()&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(l2[pos2&#32;+&#32;5]))))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;is_new_block&#32;=&#32;true;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else&#32;if&#32;(l2.compare(pos2,&#32;3,&#32;&quot;def&quot;)&#32;==&#32;0&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(pos2&#32;+&#32;3&#32;&gt;=&#32;l2.size()&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;static_cast&lt;unsigned&#32;char&gt;(l2[pos2&#32;+&#32;3]))))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;is_new_block&#32;=&#32;true;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else&#32;if&#32;(l2.compare(pos2,&#32;5,&#32;&quot;async&quot;)&#32;==&#32;0)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::size_t&#32;q&#32;=&#32;pos2&#32;+&#32;5;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;while&#32;(q&#32;&lt;&#32;l2.size()&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(l2[q])))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;++q;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(l2.compare(q,&#32;3,&#32;&quot;def&quot;)&#32;==&#32;0&#32;&amp;&amp;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(q&#32;+&#32;3&#32;&gt;=&#32;l2.size()&#32;||<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;std::isspace(static_cast&lt;unsigned&#32;char&gt;(l2[q&#32;+&#32;3]))))<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;is_new_block&#32;=&#32;true;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;(is_new_block)<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;break;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;last_body&#32;=&#32;k;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;out.start_line&#32;=&#32;decl_start;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;out.end_line&#32;=&#32;last_body;<br>
&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;true;<br>
&#32;&#32;&#32;&#32;}<br>
<br>
&#32;&#32;&#32;&#32;return&#32;false;<br>
}<br>
<!-- END SCAT CODE -->
</body>
</html>
